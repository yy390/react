# 项目开发过程

## 1、导航栏模块

**功能描述**：

- 页面导航：提供清晰的链接，引导用户前往“首页”、“发布文章”和“我的文章”等核心页面。

- 全局搜索：集成一个搜索框，允许用户在任何页面输入关键词搜索文章。

- 用户状态展示：

- 未登录状态：显示“登录”和“注册”按钮。

- 已登录状态：显示用户的名称和菜单（包含“我的文章”和“退出登录”选项）。

**技术实现**：

1、在开发过程中，通过使用React Router的NavLink实现高亮，

2、路由管理 (Routing)：

- 使用 React Router 的 useNavigate 和 Link 组件来处理页面跳转。

3、全局状态管理 (State Management)：

- 用户状态：

  组件通过自定义Hook useUser() 从 UserContext 中获取当前用户的登录状态 (isLogin)和用户信息 (user)。这是决定导航栏显示“登录/注册”按钮还是用户名的关键。

- 搜索状态

  组件通过 useSearch() 从 SearchContext中获取 setSearchKeyword 函数。当用户在搜索框中输入并按下回车时，该函数会被调用，将搜索关键词更新到全局的 SearchContext 中。

- 登录/注册：点击按钮会打开一个模态框（Modal），处理用户的登录和注册流程。

- 退出登录：在下拉菜单中点击“退出登录”会调用从 UserContext 中获取的 logout 函数，该函数负责清除登录状态和本地存储（localStorage）中的用户信息。

**问题解决**

​		需要知道用户的登录状态，而登录操作可能在任何地方发生。通过引入 React Context (UserContext)。将用户登录状态和相关操作（login, logout, register）封装在一个全局的Context中。

## 2、轮播图模块

**功能描述**：

- 动态内容展示：自动拉取浏览量最高的4篇文章作为轮播内容。

- 自动播放：以每5秒一次的频率自动切换到下一张幻灯片，形成连续滚动的效果。

- 手动控制：

- 用户可以通过点击幻灯片下方的导航点（dots）直接跳转到任意一张幻灯片。

- 当前激活的幻灯片对应的导航点会高亮显示。

- 交互式跳转：整个幻灯片区域（图片）是一个可点击的链接，用户点击后会直接导航到该文章的详情页面。

**技术实现**：

自动播放功能是通过一个 useEffect Hook结合 setInterval 定时器实现的。

**问题解决**：

在开发过程中，出现图片大小不一致导致轮播图区域出现大量空白，通过将轮播图区域的高度固定，图片通过填充，实现轮播效果。

文章数据类型中，image 字段被定义为 string | null，但 <img> 标签的 src 属性不能接受 null 值，这导致了TypeScript编译错误。通过在渲染前，先使用 .filter(item => item.image) 过滤掉所有没有图片信息的文章数据。

## 3、搜索功能模块

​	**功能描述**：

- 全局可访问性：搜索框位于顶部导航栏 (NavBar) 中，确保用户在应用的任何角落都可以随时发起搜索。

- 即时反馈：用户输入关键词并按下回车或点击搜索按钮后，应用会立即响应。

- 统一的结果展示：无论用户从哪个页面发起搜索，都会被自动导航到首页，并在首页的文章列表区域看到匹配搜索关键词的结果。

- 状态保持与清除：

- 搜索关键词会被记住，即使用户在结果页进行排序等操作，搜索筛选依然生效。

- 当用户清空搜索框并重新发起一次空搜索时，文章列表会恢复到未筛选的默认状态

​	**技术实现**：使用useRef实现防抖功能。

​	**问题解决**： 搜索时频繁触发API调用，影响性能，通过实现防抖机制，延迟300ms执行搜索。

## 4、文章列表模块

**功能描述**：

- 在首页，文章以标签页的形式分为“最新发布”和“热门文章”三个视图，允许用户根据不同偏好进行切换。

- 当用户执行搜索时，该模块会动态地仅显示匹配搜索结果的文章。

- 列表中的每一项都清晰地展示了文章的关键信息，包括：标题、作者、发布时间、简短描述、标签、以及互动数据（浏览量、点赞数、评论数）。

- 整个文章条目都是一个可点击的区域，用户点击后会直接导航到该文章的详情页面。

**技术实现**：

- onChange 事件被用来更新当前激活的标签页状态。
- 通过 props 从其父组件（HomePage）接收一个已经根据搜索关键词预过滤过的文章数组 (articles)。
- 使用 useState 来管理：activeTab: 当前激活的标签页

**问题解决**：

- 文章列表性能问题，大量数据时渲染慢，可以将数据加载在本地，通过实现虚拟滚动（考虑使用react-window），添加分页功能，优化图片懒加载。

## 5、注册登录模块

​	**功能描述**：

- 对于未登录用户，导航栏右上角会显示一个登录/注册按钮。

- 点击登录或者注册按钮，会弹出一个模态框。模态框内嵌了一个可以通过页签（Tabs）切换的表单，包含“登录”和“注册”两个功能。

- 表单需要用户输入“用户名”和“密码”。

- 注册成功后，系统会自动将用户置为登录状态。

- 登录成功后，导航栏右上角会显示用户的头像和用户名，并提供一个包含“我的文章”和“退出登录”选项的下拉菜单。

- 即使用户刷新页面，登录状态也会被保持，不会丢失。

​	**技术实现**：

- 使用Context API管理用户状态

​	**问题解决**：

- 用户状态在页面刷新后丢失，使用localStorage持久化用户状态。

- 用户的登录状态（是否登录、用户名等）需要被多个组件（如 Navbar, PublishPage）共享。如果通过 props 层层传递会非常繁琐。

- 解决方案：代码中采用了 React Context API (UserContext)。将用户状态和相关操作函数放在 Context 中，任何需要它们的组件都可以通过 useUser() Hook 轻松获取，实现了状态的全局共享和响应式更新。

## 6、文章发布模块

​	**功能描述**：

- 导航栏上有一个【发布】按钮。点击【发布】按钮时，系统会首先检查用户是否已登录。如果用户未登录，系统不会弹出发布表单，而是会弹出登录/注册模态框，引导用户先完成登录。只有已登录用户才能打开文章发布界面。

- 点击【发布】按钮后，会弹出一个功能完善的表单。表单包含多个字段：文章标题 、文章摘要、文章内容、技术标签、公开状态、提交时按钮会显示加载状态，防止重复提交。用户填写完表单并点击“发布”后，发布成功后，会显示“发布成功”的全局提示。

- 新发布的文章会立即出现在首页的文章列表中，无需刷新页面。

- 发布模态框会自动关闭，并且表单内容会被清空，方便下次使用。

​	**技术实现**：

- 导航栏的【发布】按钮通过 usePublish() Hook 获取到 setIsPublishOpen 函数。点击时，它会先检查登录状态，如果已登录，就调用 setIsPublishOpen(true) 来通知 Layout 组件打开模态框。

​	**问题解决**：

发布后文章不实时显示，使用Context API统一管理文章状态，发布后立即更新。

文章发布后，不刷新页面就能看到结果，通过Context 实现状态的单向数据流。当 handlePublishSuccess 调用 addArticle 时，ArticleContext 内部的文章列表状态发生了变化，React 会自动检测到这个变化并重新渲染文章列表

## 7、文章详情模块

​	**功能描述**：

- 页面能根据URL (/article/:id) 中的 id，动态加载并展示对应文章的详细内容，包括标题、作者、发布时间、阅读数、标签、图片和正文。

- 私密文章：对于设置为“私密”的文章，只有作者本人才能查看，其他用户访问会收到权限不足的提示。

- 每次进入文章详情页，文章的阅读量会自动加一，并同步更新到首页列表。

- 页面下方有一个功能完整的评论区。可以进行发表评论：登录用户可以发表对文章的评论。回复系统：可以对评论进行回复，也可以对其他人的回复进行再回复，支持嵌套对话。点赞功能：可以对评论和回复分别点赞。即时反馈：所有评论、回复、点赞操作都会立即在界面上生效，无需刷新。

​	**技术实现**：

- 使用 react-router-dom 的动态路由功能 (path: "/article/:id") 来匹配不同的文章页面。

- 在 Article 组件内部，使用 useParams() Hook 来捕获URL中的 id，作为获取数据的关键索引。
- 首次加载或 localStorage 为空时，作为初始数据，后期再获取数据的时候通过localStorage。

​	**问题解决**： 

- 阅读量重复统计，使用useRef标记是否已增加阅读量。
- 文章不存在时的错误处理，添加完善的错误处理和用户提示。
- 评论区需要知道当前用户正在回复哪条评论，以便显示输入框，通过在 CommentList 组件内部使用 useState (replyingTo) 来管理这个局部的UI状态

## 8、评论模块

**功能描述**：

- 在文章底部，登录用户可以看到一个评论输入框，可以发表对当前文章的一级评论。

- 未登录用户输入框为禁用状态，并提示先登录。

- 用户可以对任何一条一级评论进行回复。

- 用户也可以对其他人的回复进行再次回复，形成了对话，并在UI上通过缩进清晰地展示了层级关系。

- 用户可以对一级评论进行点赞。

- 用户也可以对二级回复进行点赞。点赞功能是区分层级的。

- 所有操作（发表、回复、点赞）都是即时生效的，无需刷新页面，提供了流畅的用户体验。

- 操作成功后，系统会给出明确的成功提示信息（如“评论发表成功！”）。

- 进行回复时，回复框会动态地出现在被回复的评论下方。

- 整个模块对权限进行了严格控制，所有写入操作（发表、回复、点赞）都必须在登录状态下才能进行。如果用户未登录就尝试操作，会收到“请先登录”的提示。

**技术实现**：

- CommentContext.tsx 通过 useEffect 和 localStorage 实现了评论数据的持久化。应用启动时从 localStorage 加载评论，任何评论数据发生变化时，都会被自动写回 localStorage。
- 通过 useComments() Hook 从 CommentContext 获取数据和操作函数

**问题解决**：

​		评论数据管理复杂， 使用Context API统一管理评论状态。

## 9、我的文章模块

登录用户设计的个人文章管理中心。

**功能描述**

- 文章列表展示：自动获取并展示当前登录用户创建的所有文章。
- 权限控制：只有登录用户才能访问此页面，并且只能管理自己的文章。
- 状态显示：每篇文章都会以标签（Tag）的形式清晰地标明其“公开”或“私密”的状态。
- 文章操作：用户可以对自己的文章进行“修改”和“删除”操作。
- 安全确认：在删除文章时，会弹出一个确认对话框，防止用户误操作。

**技术实现**

页面的实现充分利用了现代React生态的特性，实现了高效、可靠的功能。

**数据来源与状态管理** 

- 页面数据并非直接通过API请求获取，而是通过React的Context API从全局状态中订阅。useUser() hook用于获取当前用户信息（如登录状态和用户名），useArticles() hook用于获取全局的文章列表和操作文章的方法。

**文章数据过滤 ：**

- 为了只显示当前用户的文章，代码使用了React的 useMemo hook。它会监听全局文章列表 articles 和用户名 user.name 的变化。

**文章渲染与UI组件：**

- 使用 List 组件来循环渲染 myArticles 数组，以列表的形式展示用户的文章。

- 每个列表项 List.Item 都包含了文章的标题、描述、元数据（作者、发布时间、浏览量）以及状态标签。

- Tag 组件展示文章的公开状态，通过不同的颜色显示状态。

**路由与页面导航 ：**

- 页面的跳转功能由 React Router 提供。

- 通过 useNavigate hook 获取导航函数。当用户点击“修改”按钮时，会调用 navigate('/edit/:id') 将用户带到文章编辑页面。

**用户交互与操作：**

- 修改文章：handleEdit 函数负责处理修改逻辑，在跳转前会进行权限检查，确保用户不能编辑他人的文章。

- 删除文章：为了提升用户体验并防止误删，删除按钮被包裹在 Popconfirm 组件中。用户点击删除后会先弹出气泡确认框。只有当用户确认后，才会执行 handleDelete 函数，调用从Context中获取的 deleteArticle 方法来更新全局状态，并使用message.success给出操作成功的提示。